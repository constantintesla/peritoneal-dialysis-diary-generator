<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор дневников перитонеального диализа</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Генератор дневников перитонеального диализа</h1>
        </header>

        <!-- Панель действий с кнопками -->
        <div class="action-panel">
            <button id="generateBtn" class="btn-primary">Сгенерировать дневники</button>
            <button id="exportPdfBtn" class="btn-secondary" style="display: none;">Экспорт в PDF</button>
        </div>

        <div class="main-content">
            <!-- Панель настроек -->
            <aside class="settings-panel">
                <h2>Настройки</h2>
                
                <div class="setting-group">
                    <label for="startDate">Начальная дата:</label>
                    <input type="date" id="startDate" required>
                </div>

                <div class="setting-group">
                    <label for="daysCount">Количество дней:</label>
                    <input type="number" id="daysCount" min="1" max="60" value="30" required>
                </div>

                <div class="setting-group">
                    <label for="dialysisScheme">Схема диализа:</label>
                    <select id="dialysisScheme" required>
                        <option value="">Выберите схему</option>
                        <option value="papd4">ПАПД 4 раствора (08.00, 13.00, 18.00, 23.00)</option>
                        <option value="papd5">ПАПД 5 растворов (08.00, 12.00, 16.00, 20.00, 24.00)</option>
                        <option value="apd2">АПД 2 раствора (22.00, 22.00)</option>
                        <option value="apd3_1">АПД 3 раствора (22.00, 22.00, 22.00)</option>
                        <option value="apd3_2">АПД 3 раствора (22.00, 22.00, 07.00)</option>
                        <option value="apd4">АПД 4 раствора (22.00, 22.00, 22.00, 07.00)</option>
                        <option value="custom">Ввести вручную</option>
                    </select>
                </div>

                <div class="setting-group" id="customSchemeGroup" style="display: none;">
                    <label for="customScheme">Время процедур (через запятую, например: 08.00, 13.00, 18.00, 23.00):</label>
                    <input type="text" id="customScheme" placeholder="08.00, 13.00, 18.00, 23.00">
                </div>

                <div class="setting-group">
                    <label>Настройки манипуляций:</label>
                    <button type="button" id="openProceduresModalBtn" class="btn-outline" disabled>Открыть попап</button>
                    <small class="setting-hint">Появится после выбора схемы и ввода времени процедур.</small>
                </div>

                <div class="setting-group">
                    <label for="solutionType">Тип раствора (глобальное значение):</label>
                    <select id="solutionType" required>
                        <option value="Диасолюшн 1,5%">Диасолюшн 1,5%</option>
                        <option value="Диасолюшн 2,3%">Диасолюшн 2,3%</option>
                        <option value="Диасолюшн 4,25%">Диасолюшн 4,25%</option>
                        <option value="Ультрасолюшн">Ультрасолюшн</option>
                        <option value="custom">Другой (ввести вручную)</option>
                    </select>
                </div>

                <div class="setting-group" id="customSolutionGroup" style="display: none;">
                    <label for="customSolution">Название раствора:</label>
                    <input type="text" id="customSolution" placeholder="Например: Дианил 1,36%">
                </div>

                <div class="setting-group">
                    <label>Диапазон систолического АД:</label>
                    <div class="range-inputs">
                        <input type="number" id="systolicMin" value="124" min="0" required>
                        <span>—</span>
                        <input type="number" id="systolicMax" value="134" min="0" required>
                    </div>
                </div>

                <div class="setting-group">
                    <label>Диапазон диастолического АД:</label>
                    <div class="range-inputs">
                        <input type="number" id="diastolicMin" value="78" min="0" required>
                        <span>—</span>
                        <input type="number" id="diastolicMax" value="86" min="0" required>
                    </div>
                </div>

                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="showWeight">
                        Отображать графу "Вес"
                    </label>
                </div>

                <div class="setting-group" id="weightRangeGroup" style="display: none;">
                    <label>Диапазон веса (кг):</label>
                    <div class="range-inputs">
                        <input type="number" id="weightMin" value="60" min="0" step="0.1">
                        <span>—</span>
                        <input type="number" id="weightMax" value="90" min="0" step="0.1">
                    </div>
                </div>

                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="syncDiaries" checked>
                        Синхронизировать изменения между дневниками
                    </label>
                    <small class="setting-hint">Если включено, изменения в одном дневнике применяются ко всем. Если выключено, можно редактировать каждый дневник индивидуально.</small>
                </div>

                <div class="setting-group">
                    <label for="nurseTitle">Должность медперсонала:</label>
                    <select id="nurseTitle">
                        <option value="Медицинская сестра">Медицинская сестра</option>
                        <option value="Медицинский брат">Медицинский брат</option>
                        <option value="custom">Другая (ввести вручную)</option>
                    </select>
                </div>

                <div class="setting-group" id="customNurseTitleGroup" style="display: none;">
                    <label for="customNurseTitle">Введите должность:</label>
                    <input type="text" id="customNurseTitle" placeholder="Например: Фельдшер">
                </div>

                <div class="setting-group">
                    <label for="nurseName">ФИО медработника:</label>
                    <input type="text" id="nurseName" placeholder="Иванова И.И.">
                </div>

                <div class="setting-group">
                    <label for="doctorName">ФИО врача:</label>
                    <input type="text" id="doctorName" placeholder="Петров П.П.">
                </div>
            </aside>

            <!-- Область предпросмотра -->
            <main class="preview-area">
                <div id="previewContainer">
                    <p class="placeholder">Настройте параметры и нажмите "Сгенерировать дневники"</p>
                </div>
            </main>
        </div>
    </div>

    <!-- Попап с настройками манипуляций -->
    <div id="proceduresModal" class="modal" aria-hidden="true">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="proceduresModalTitle">
            <div class="modal-header">
                <h3 id="proceduresModalTitle">Настройки манипуляций</h3>
                <button type="button" id="closeProceduresModalBtn" class="modal-close" aria-label="Закрыть попап">&times;</button>
            </div>
            <div class="modal-actions">
                <button type="button" id="applyGlobalValuesBtn" class="btn-apply-global">Применить глобальные значения</button>
            </div>
            <div id="proceduresSettingsContainer" class="procedures-settings-container"></div>
            <div class="modal-footer">
                <button type="button" id="closeProceduresModalFooterBtn" class="btn-secondary">Отмена</button>
                <button type="button" id="saveProceduresBtn" class="btn-primary">Готово</button>
            </div>
        </div>
    </div>

    <script>
        // Проверка загрузки всех необходимых файлов
        window.addEventListener('error', function(e) {
            console.error('Ошибка загрузки файла:', e.filename, e.message);
            if (e.filename && (e.filename.includes('.css') || e.filename.includes('.js'))) {
                alert('Ошибка загрузки файла: ' + e.filename + '\n\nУбедитесь, что все файлы находятся в одной папке:\n- index.html\n- styles.css\n- script.js\n- html2pdf.bundle.min.js');
            }
        }, true);
        
        // Проверка наличия необходимых файлов после загрузки
        window.addEventListener('load', function() {
            const stylesLoaded = document.styleSheets.length > 0;
            const html2pdfLoaded = typeof html2pdf !== 'undefined';
            
            if (!stylesLoaded) {
                console.error('CSS файл не загружен!');
                alert('Ошибка: файл styles.css не загружен!\n\nУбедитесь, что файл styles.css находится в той же папке, что и index.html');
            }
            
            if (!html2pdfLoaded) {
                console.error('Библиотека html2pdf не загружена!');
                alert('Ошибка: библиотека html2pdf.bundle.min.js не загружена!\n\nУбедитесь, что файл html2pdf.bundle.min.js находится в той же папке, что и index.html');
            }
            
            // Проверка основных функций
            if (typeof generateDiaries === 'undefined') {
                console.error('Функция generateDiaries не найдена!');
                alert('Ошибка: файл script.js не загружен или содержит ошибки!\n\nУбедитесь, что файл script.js находится в той же папке, что и index.html');
            }
        });
    </script>
    <script src="html2pdf.bundle.min.js" onerror="alert('Ошибка загрузки html2pdf.bundle.min.js! Убедитесь, что файл находится в той же папке, что и index.html')"></script>
    <script src="script.js" onerror="alert('Ошибка загрузки script.js! Убедитесь, что файл находится в той же папке, что и index.html')"></script>
</body>
</html>

