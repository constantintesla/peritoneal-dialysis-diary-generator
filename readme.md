# Инструкция пользователя
## Генератор дневников перитонеального диализа

### Общее описание

Приложение предназначено для автоматической генерации дневников перитонеального диализа с последующим экспортом в PDF для печати. Каждый дневник соответствует одному дню, на одной странице размещается до 4 дневников.

---

## Начало работы

1. Откройте файл `index.html` в браузере
2. В правой панели настройте все необходимые параметры
3. Нажмите кнопку **"Сгенерировать дневники"** в верхней панели
4. Просмотрите результат в области предпросмотра
5. Нажмите кнопку **"Экспорт в PDF"** для сохранения документа

---

## Настройка параметров

### 1. Даты и количество дней

**Начальная дата:**
- Выберите дату начала периода ведения дневников
- Дата выбирается через календарь

**Количество дней:**
- Укажите количество дней для генерации дневников (от 1 до 60)
- По умолчанию: 30 дней
- Даты будут сгенерированы последовательно, без пропусков

---

### 2. Схема диализа

Выберите одну из предложенных схем или введите время вручную:

**Доступные схемы:**
- **ПАПД 4 раствора**: 08.00, 13.00, 18.00, 23.00
- **ПАПД 5 растворов**: 08.00, 12.00, 16.00, 20.00, 24.00
- **АПД 2 раствора**: 22.00, 22.00
- **АПД 3 раствора (вариант 1)**: 22.00, 22.00, 22.00
- **АПД 3 раствора (вариант 2)**: 22.00, 22.00, 07.00
- **АПД 4 раствора**: 22.00, 22.00, 22.00, 07.00
- **Ввести вручную**: введите время через запятую (например: 08.00, 13.00, 18.00, 23.00)

---

### 3. Настройки манипуляций (попап)

После выбора схемы появляется кнопка **«Настроить манипуляции»**. Нажмите её, чтобы открыть попап с перечнем всех манипуляций (времён из схемы). Для каждой можно указать:

- Вид раствора (выпадающий список с быстрым доступом к глобальным вариантам и кастомному названию)
- Объём введённого раствора (мл)
- Ультрафильтрацию / разницу (мл), от которой рассчитывается объём слитого

Дополнительно доступна кнопка **«Применить глобальные значения»** — она копирует текущие глобальные настройки раствора/объёма/диапазона в каждую строку попапа.

Все изменения в попапе сохраняются автоматически при нажатии «Готово». Эти значения становятся шаблоном для генерации и также синхронно подтягиваются во все дни при редактировании таблиц.

---

### 4. Тип раствора (глобальное значение)

**Доступные варианты:**
- Диасолюшн 1,5%
- Диасолюшн 2,3%
- Диасолюшн 4,25%
- Ультрасолюшн
- **Другой (ввести вручную)**: введите название раствора в появившемся поле

---

### 5. Объем введенного раствора (глобальное значение)

**Доступные варианты:**
- 2000 мл
- 5000 мл
- **Ввести вручную**: укажите объем в миллилитрах

---

### 6. Объем слитого раствора (глобальный диапазон)

Настройте диапазон, который используется по умолчанию при заполнении попапа кнопкой «Применить глобальные значения» и при генерации случайных значений:

- **Минимальное значение**: по умолчанию 2100 мл
- **Максимальное значение**: по умолчанию 2500 мл
- Значения генерируются с шагом 50 мл
- Для каждого дневника значения будут случайными в указанном диапазоне, если вы не задали конкретную ультрафильтрацию в попапе

---

### 7. Артериальное давление (АД)

Настройте диапазоны для автоматической генерации АД:

**Систолическое АД:**
- Минимальное значение: по умолчанию 124
- Максимальное значение: по умолчанию 134

**Диастолическое АД:**
- Минимальное значение: по умолчанию 78
- Максимальное значение: по умолчанию 86

АД будет отображаться в формате "систолическое/диастолическое" (например: 127/82)

---

### 8. Вес (опционально)

- Установите галочку **"Отображать графу 'Вес'"**, если необходимо включить эту графу
- При включении укажите диапазон веса:
  - Минимальное значение: по умолчанию 60 кг
  - Максимальное значение: по умолчанию 90 кг
- Если галочка не установлена, графа "Вес" не будет отображаться в дневниках

---

### 9. Данные медперсонала

**Должность медперсонала:**
- Медицинская сестра (по умолчанию)
- Медицинский брат
- Другая (ввести вручную): введите должность в появившемся поле

**ФИО медработника:**
- Введите фамилию и инициалы медсестры/медбрата
- Пример: Иванова И.И.
- Если не указано, будет отображаться "________________"

**ФИО врача:**
- Введите фамилию и инициалы врача
- Пример: Петров П.П.
- Если не указано, будет отображаться "________________"

---

## Генерация дневников

1. После настройки всех параметров нажмите кнопку **"Сгенерировать дневники"** в верхней панели
2. Дневники появятся в области предпросмотра справа
3. Каждая страница содержит до 4 дневников (остальные автоматически переносятся на новый лист)
4. В конце каждого дневника автоматически подставляется подпись медсестры
5. В конце каждой страницы (после последнего дневника) автоматически подставляются подписи врача и медсестры с увеличенными полями для подписи

---

## Автоматически генерируемые данные

Если в попапе вы задали точные значения, они будут использованы напрямую. Остальные поля приложение заполнит автоматически:

- **Объем слитого раствора**: рассчитывается как сумма объёма введённого и ультрафильтрации, указанной для манипуляции. Если значение не задано, используется случайное число из глобального диапазона.
- **Разница**: автоматически рассчитывается как разница между слитым и введенным объемом
- **Сумма разниц**: внизу каждого дневника отображается сумма всех разниц за день
- **Температура**: случайное значение в диапазоне 36,5-36,7°C
- **Артериальное давление**: случайное значение в указанных диапазонах для систолического и диастолического давления
- **Вес**: случайное значение в указанном диапазоне (если включено)
- **Особенности**: по умолчанию "без особенностей" для всех записей

---

## Экспорт в PDF

1. После генерации дневников кнопка **"Экспорт в PDF"** станет видимой
2. Нажмите кнопку **"Экспорт в PDF"**
3. Документ будет автоматически сохранен на вашем компьютере
4. Имя файла: `Дневники_ПД_ДД_ММ_ГГГГ.pdf` (где ДД_ММ_ГГГГ - текущая дата)

**Особенности PDF:**
- Формат страницы: A4 книжная ориентация (вертикальная)
- На каждой странице: до 4 дневников (остальные переносятся на новый лист)
- Вверху каждой страницы: заголовок "Дневник перитонеального диализа" (только один раз на странице)
- В конце каждой страницы: подписи врача и медсестры с увеличенными полями для подписи
- В конце каждого дневника: подпись медсестры
- Пустые страницы не создаются

---

## Структура дневника и редактирование в предпросмотре

Каждый дневник содержит:

1. **Дату** (вверху блока)
2. **Таблицу** со следующими графами:
   - Время
   - Вид раствора (можно менять прямо в таблице, и изменения применятся ко всем дням для данной манипуляции)
   - Объем введенного, мл (редактируемая ячейка; синхронно обновляет все дни и автоматически пересчитывает разницу)
   - Объем слитого, мл (редактируемая ячейка)
   - Разница, мл (редактируемая ячейка)
   - Температура (редактируемая)
   - АД (редактируемая)
   - Вес, кг (если включено)
   - Особенности (редактируемая строка)
3. **Строку "Итого"** с суммой всех разниц за день (обновляется автоматически при правках)
4. **Подпись медсестры** в конце дневника

> **Важно:** любое изменение в любой ячейке таблицы автоматически синхронизируется со всеми остальными днями для той же манипуляции (например, если поменять раствор в первой процедуре первого дня, он изменится во всех днях для этого времени).

---

## Советы по использованию

1. **Перед генерацией** проверьте все параметры, особенно:
   - Правильность выбранной схемы диализа
   - Корректность диапазонов для генерации данных
   - Правильность ФИО медперсонала

2. **После генерации** просмотрите предпросмотр перед экспортом в PDF

3. **При необходимости** можно изменить параметры и сгенерировать дневники заново

4. **Для печати** используйте экспортированный PDF-файл

---

## Решение проблем

**Кнопка "Экспорт в PDF" не работает:**
- Убедитесь, что дневники были сгенерированы
- Проверьте подключение к интернету (требуется для загрузки библиотеки html2pdf)
- Обновите страницу и попробуйте снова

**Дневники не генерируются:**
- Проверьте, что заполнены все обязательные поля (отмечены красной звездочкой)
- Убедитесь, что выбрана схема диализа
- Проверьте, что указан тип раствора

**Неправильные данные в дневниках:**
- Измените параметры в панели настроек
- Нажмите "Сгенерировать дневники" заново

---

## Технические требования

- Современный браузер (Chrome, Firefox, Edge, Safari)
- Подключение к интернету (для загрузки библиотеки html2pdf.js)
- JavaScript должен быть включен

---

## Контакты и поддержка

При возникновении проблем или вопросов обращайтесь к разработчику приложения.

---

**Версия:** 1.2  
**Дата обновления:** 2025

### Изменения в версии 1.2:
- Настройки манипуляций перенесены в отдельный попап с индивидуальным выбором раствора, объёма и УФ для каждой процедуры
- Добавлена кнопка «Применить глобальные значения» для быстрого заполнения попапа
- Редактирование таблиц предпросмотра теперь синхронизируется между всеми днями
- Обновлена документация и стили интерфейса

### Изменения в версии 1.1:
- Изменена ориентация PDF на книжную (вертикальную)
- Увеличено количество дневников на странице до 4
- Заголовок "Дневник перитонеального диализа" отображается только в шапке страницы
- Увеличены поля для подписей врача и медсестры
- Исправлена проблема с пустыми страницами в PDF
- Уменьшены отступы между дневниками для более компактного размещения

